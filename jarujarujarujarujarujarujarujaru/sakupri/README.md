# sakupri
「さくらいろプリズム」の公式リポジトリ

# リンク
- ゲームプレビュー（リンクを知っている人は誰でもアクセスできるので、公開しないこと！）：https://sakupri-dev-bs12.herokuapp.com/
  - なんか謎のエラーで2022年4月ころからpush時に更新されなくなったぽい。ゲームの中身には影響ないのでとりあえず無視。プレビューは各自の環境でお願いします。
- タスク管理：https://trello.com/b/tSFVxMLB
- ティラノスクリプト公式サイト（基本的にはここを参照）：https://tyrano.jp/
- さくプリ公式サイト：https://blooming-spectrum.com/sakurairo-prism/

# 210430追加希望_from_Sho
- 表情差分　照れ　驚き
- 効果音　シュート決まった音、歓声、シュートはずれた音、喫茶店入り口カランコロン
- 背景　勝手に足したもの（公園朝と夕、家電屋、都会街中、体育館、喫茶店）

# バグ
- 再生されるボイスが環境によって異なる（2_12の葵ボイスなど）
  - これはたぶんデバッガの仕様じゃないかな？デバッガ上で別のシーンにジャンプしたとき、ボイス連続再生タグがリセットされないのはおそらくデバッガの仕様でティラノ自体は正しく動いているはず（と思いたい）
  - 実際に通しでプレイしたとき同様の事象が発生したら要調査。
  - message_initの中にvostopを入れたので、多分このバグは修正できたと思われる。
- chara_showタグでpage="back"を指定すると、表示がおかしくなる。
  - これはたぶんティラノのバグ。ソースコード見た感じ恐らくそうだと思われる。
  - maskタグ使うとかで回避できるのでとりあえずは使わない方向で。
  - バグ修正したので使えます！
- cameraタグをmaskで隠している最中に使う（mask明け最初のカメラ位置を定義する）と、マスク明けたときの最初のカメラ位置がおかしくなる。
  - こうなる場合とならない場合がある。再現性がいまいち。
  - cameraタグの前後にwaitを入れると比較的マシなようだが、完ぺきではなさそう。
  - wait, camera, mask_offの順なら大丈夫そうだけど、camera, wait, mask_offだとバグるっぽい？？？
  - おそらく、デバッグ時に特有の問題という感じ。
  - カメラでレイヤー指定する場合、一回初期状態を手動で設定してあげれば大丈夫っぽい。
  - camera x="0" y="0" zoom="1" time="0" layer="0" みたいなのを、カメラ初期位置の前にもってくればokぽい
- imageで画像を表示するとき、imageを出すより前にカメラ位置を動かすと、その位置が反映されない（次動かしたときに変になる）。
  - 対処としては、imageであらかじめオフセットを指定する。
- ラベル（*startとか）にハイフンを入れると、既読管理でエラーになる
  - なぜか？それは、ラベルがjavascriptのオブジェクトのキーとして使用されるから。
  - hogehoge.end1-1 みたいになると、javascriptでは hogehoge.end1 - 1 として解釈されて、undefined - 1 => NaN になる。
  - したがって、ラベルにハイフンとか、javascriptで演算子として解釈される記号を含めないようにしましょう。
- 100MB以上のファイルはpush時にはじかれるので注意
- ？？？とか、最後の青葉とかの名前が初音さんになる現象が発生している
  - たぶんだけど、3章で？？？で名前登録したのが引き継がれていると思われる
  - ティラノの仕様で、chara_newしたときにnameとjnameが逆引きで登録される。
  - TYRANO.kag.stat.jcharas["？？？"] = "hatsune"のように。
  - 直接deleteしてやることで解決しました
- メッセージレイヤを一時的に背景だけ透明にしたいとき、本来はopacityとかだけ変えてやればよさそうだけど、それだと幅とかも変わってしまうので、回避策として、opacityなど登録する都度、first.ksと同じようにwidthやmarginを再度登録する。これで意図しないパラメータの変更を防げる。
- 選択肢をb=から始めると表示位置がずれる
  - マクロを修正した

# op修正点
- 生活感を出す。（部活の様子、ホワイトボードに大会のブレスト書き出しているなど。街の様子など）
- ローファーなど、細部のこだわりを見せる。
- ストーリー上の伏線を忍ばせる。
- いったん別の曲で合わせてつくってみる。最後に本チャンに置き換え。
- もっとストーリーに寄り添う！

# ToDo
- OP, EDなどを追加
- ライセンスまわりの明記（音楽素材のクレジット）
- リリース前にデバッグ用の記述を削除（特に変数の仮入れとか）
- 不要ファイルの削除
- パッチ作成
- ゲーム閉じるときの声を出したい

# 効果音
  - 入店ベル
  - カメラのシャッター音
  - パイプ椅子を叩きつける音
  - コンビニ入店音
  - セミ
  - 雨
  - 竿燈
  - ドアノック
  - 列車の音
  - ざわざわ……
  - 歓声
  - シュートが入る音
  - ホイッスル
  - シュート外れる音

# 表情追加希望
- ジト目
- ドヤ顔
- 真顔（ヤンデレ寄り）
- 真剣
- 泣きそう
- 号泣（ギャグ調）
- 気まずい感じのやつもう一つ
- 弱弱しいほほえみ
- やれやれ（ため息）
- 不機嫌
- ショック（まじめなやつ）
- おいおいおい嘘だろ？？？
- は？（半ギレ）
- 意地悪な笑み
- 伏し目（諦観）
- わあ（感動）
- 苦しい、痛い

# shoの感想
- scene1_01.ksの最初の葵の驚きの表情がチープ
- 夕方の公園のイベントCGの顔が暗い（プラグインが間違って効いてしまっている）
- 教室とかで背景もキャラ絵も暗い感じがする
- scene1_09.ksの写真を持っている葵が闇落ち感がある
- 澪の立ち絵が悲しいシーンで違和感
- ルビが入ると行がずれる
- 絵文字の文字化けを修正
- 大会の始まるシーンの演出が過剰、バグあり
- 3_01で澪がヤンデレ化するのが怖い
- 初音のリボンがダサい
- 3章の問題のくだり、表示を工夫。
- 3人が同時に出るところ、同時に出るように修正

# tips
- A4比率の画像を1280x720の中に配置するとき、top="-185"でちょうど下端になる
- 自動ライティングプラグインは、背景ごとに自動ライティングの有効無効を設定できる。したがって、white.pngとかblack.pngとかにライティング無効を指定して、イベントCGなどでその背景を表示すれば不本意に色が変わることを防げる。
- カメラでzoomが大きすぎると、おそらく描画メモリか何かの問題で画面が暗くなる。ので、暗くなったらzoomを小さくすればいいかもしれない。
- transを使う前にはちゃんとreset_cameraしてあること。
- chara_showでbackページに表示するとき一瞬表示される問題はティラノ側のバグなので直した。
- camera layer="1" を使うとき、あらかじめレイヤー1を表示させておかなければならない。意外と盲点なので注意。
- システム変数やセーブデータ、既読ログなどのシステムデータは、ブラウザのlocalStorageに保存されている。ので、もろもろ消したいときはlocalStorageの中身を消せばよい

# コーディングで気を付けてほしいこと
- ある程度段落を意識して、まとまりごとでスペースをあける
- パラメータには""をつける（bg storage="aaa.jpg"のように）。つけなくても動くけど見た目を統一したい
- maskなどで隠れている間の裏方の処理は、基本ゼロ秒で。意図的に時間をあけたいときはwaitタグを使う